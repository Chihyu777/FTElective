<!DOCTYPE html>
<html>

<head>
    <title>北商財稅系人工選課</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.8/dist/semantic.min.css">
    <link rel="icon" href="images/icon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.8/dist/semantic.min.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
    <div class="header">
        <img src="/images/banner1.png" alt="這是背景圖">
    </div>
    <div class="ui top   secondary   menu" id="tab">
        <a class=" active item" data-tab="record">選課紀錄</a>
        <a class="item" data-tab="push">加選</a>
        <a class="item" data-tab="pull">退選</a>

    </div>
    <div class="ui bottom   active tab segment" data-tab="record">
        <div>選課紀錄</div>
        <div id="record"></div>
    </div>
    <div class="ui bottom  tab segment" data-tab="push">
        <div class="des">
            <p>加選程序說明:</p>
            1、若欲加選的課程在學校選課系統中仍顯示有名額，請直接登入學校選課系統選課，不必填寫選課申請單。
            <br> 2、需人工加選的同學請先下載選課申請書，依照填寫範本所示填妥資料後上傳，選課申請書為必繳資料。
            <br> 3、若有其他特殊情況(詳見備註)請檢附上課老師同意加選之證明，例如email截圖、line截圖等方式上傳系統。
            <br> 4、若加選後學分超過修課上限規定，請附上學生報告書。
        </div>
        <button class="ui button" id="pushApply">申請</button>
    </div>

    <div class="ui bottom   tab segment" data-tab="pull">
        <div class="des">
            <p>退選程序說明:</p>
            1、必修課程請以在本班修課為原則，若遇特殊情況需要退選(ex.重補修衝堂)請檢附原任課老師同意之證明。
            <br> 2、欲退選同學請先下載選課申請書，依照填寫範本所示填妥資料後上傳，選課申請書為必繳資料。
            <br> 3、若有其他特殊情況(詳見備註)請檢附上課老師同意退選之證明，例如email截圖、line截圖等方式上傳系統。
            <br> 4、退選後若不足最低學分規定，請附上學生報告書。
        </div>
        <button class="ui button" id="pullApply">申請</button>
    </div>
    <div class="ui bottom   tab segment" data-tab="remove">
        <div class="des">請先下載減修申請書，填妥後上傳時請務必附上減修申請表</div>
        <button class="ui button" id="removeApply">申請</button>
    </div>

    <div>
        <!-- ===加選 -->
        <div class="ui modal" id="pushModal">
            <i class="close icon"></i>
            <div class="header"> 加選申請 </div>
            <div class="image content">
                <div class="field">
                    <label><span class="ui red text">*</span>選課申請書(必填)</label>
                    <input type="file" id="pushEA" />
                </div>
                <div class="field">
                    <label>學生報告書(超修或低修)</label>
                    <input type="file" id="pushER" />
                </div>
                <div class="field">
                    <label>任課老師核准證明(選填)</label>
                    <input type="file" id="pushEC" />
                </div>
            </div>
            <div class="actions">
                <div class="ui button cancel ">取消</div>
                <div class="ui button approve ">確認</div>
            </div>
        </div>

        <!-- ===退選 -->
        <div class="ui modal" id="pullModal">
            <i class="close icon"></i>
            <div class="header"> 退選申請 </div>
            <div class="image content">
                <div class="field">
                    <label><span class="ui red text">*</span>選課申請書(必填)</label>
                    <input type="file" id="pullEA" />
                </div>
                <div class="field">
                    <label>學生報告書(超修或低修)</label>
                    <input type="file" id="pullER" />
                </div>
                <div class="field">
                    <label>任課老師核准證明(選填)</label>
                    <input type="file" id="pullEC" />
                </div>
            </div>
            <div class="actions">
                <div class="ui button cancel">取消</div>
                <div class="ui button approve ">確認</div>
            </div>
        </div>

        <!-- ===減修 -->
        <div class="ui modal" id="removelModal">
            <i class="close icon"></i>
            <div class="header"> 減修申請 </div>
            <div class="image content">
                <div class="field">
                    <label><span class="ui red text">*</span>減修申請書(必填)</label>
                    <input type="file" id="removeA" />
                </div>
            </div>
            <div class="actions">
                <div class="ui button cancel">取消</div>
                <div class="ui button approve ">確認</div>
            </div>
        </div>
    </div>


    <script>
        $("body").ready(() => {
            localStorage.setItem("s_id", "test")
            $('.menu .item').tab();
            g = localStorage.getItem("graduates")
            if (g) $("#tab").append(' <div class="item" data-tab="remove">檢修</div>')

        })

        // 加選處理
        $("#pushApply").click(() => {
            $("#pushModal").modal({
                onApprove: function() {
                    let pushEA = $("#pushEA").files[0]
                    let pushER = $("#pushER").files[0] && ""
                    let pushEC = $("#pushEC").files[0] && ""
                    let formData = new FormData()
                    let s_id = localStorage.getItem("s_id")
                    formData.append("ea", pushEA)
                    formData.append("er", pushER)
                    formData.append("ec", pushEC)
                    formData.append("s_id", s_id)
                    formData.append("reason", 0)
                    $.ajax({
                        url: "./eletive",
                        "method": "POST",
                        contentType: false,
                        processData: false,
                        mimeType: "multipart/form-data",
                        data: formData,


                    }).done((res) => {
                        console.log(res)
                    })
                }
            }).modal('show')


        })

        // 退選處理
        $("#pullApply").click(() => {
            $("#pullModal").modal({
                onApprove: function() {
                    console.log("退選處理")
                    let pushEA = document.getElementById("pullEA").files[0]
                    console.log("退選處理1.1")
                    let pushER = document.getElementById("pullER").files[0]
                    console.log("退選處理1")
                    let pushEC = document.getElementById("pullEC").files[0]
                    console.log("退選處理2")
                    let formData = new FormData()
                    let s_id = localStorage.getItem("s_id")
                    formData.append("ea", pushEA)
                    formData.append("er", pushER)
                    formData.append("ec", pushEC)
                    formData.append("s_id", s_id)
                    formData.append("reason", 1)
                    console.log("退選處理3")
                    $.ajax({
                        url: "./eletive",
                        "method": "POST",
                        contentType: false,
                        processData: false,
                        mimeType: "multipart/form-data",
                        data: formData,
                        success: (msg) => {
                            console.log("ok", msg)
                        }

                    }, ).done((res) => {
                        console.log(res)
                    })
                }
            }).modal('show')
        })

        // 減修處理
        $("#removeApply").click(() => {
            $("#removeModal").modal({
                onApprove: function() {
                    let removeA = $("#removeA").files[0]
                    let formData = new FormData()
                    let s_id = localStorage.getItem("s_id")
                    formData.append("file", removeA)
                    formData.append("s_id", s_id)
                    formData.append("reason", 2)
                    $.ajax({
                        url: "./eletive",
                        "method": "POST",
                        contentType: false,
                        processData: false,
                        mimeType: "multipart/form-data",
                        data: formData,

                    }).done((res) => {
                        console.log(res)
                    })
                }
            }).modal('show')
        })
    </script>
</body>

</html>